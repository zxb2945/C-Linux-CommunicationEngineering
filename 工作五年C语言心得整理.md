# 工作第五年C语言心得整理

## 1 const

### 1.1 const 在\*左边

const 在\*左边， 比如const int *p 或 int const  *p，指针指向的值的内容不能变，即p可以任意指向一地址p=&a，但是\*p无法更改；

举例，以下函数，防止入参num被子函数修改。

```
cJson_CreatIntArray( const int * num, int count);
```

(2019.2.14)

### 1.2 const 在\*右边

const 在\*右边，比如 int * const p3=&a，指针地址不能变，所以必须初始化，\*p3可以任意赋值。

### 1.3 const修饰返回值

const修饰返回值时，其返回值内容不能被修改，只能复制给加const修饰的同类型指针。

```
const char *str = cJson_GetErrorPtr();
```

## 2 static

### 2.1  修饰函数局部变量

修饰函数局部变量，开辟内存；

### 2.2  修饰全局函数和全局变量

修饰全局函数和全局变量——》》只能在本源文件使用，即便extern外部声明也不行；

## 3 指针

### 3.1 双重指针

```
char **p = "123";
```

上记表达式的解释如下：

| 地址      | 值                       |
| --------- | ------------------------ |
| p = 0x81  | *p = *(0x81) = 0x82      |
| *p = 0x82 | \*(*p) = *(0x82) = "123" |

### 3.2 函数指针

以下是函数指针应用的一个例子，注意TBL1和TBL_p是两个层次上的数组，合起来其实是一个二维数组。

```
typedef struct{
	int num;
	int* fun(void*); /*结构体中的函数指针，即函数名，其代表函数的入口地址*/
}STR;

STR TBL1[] =  /*结构体数组，数组名本身是指针*/
	{1, FUN1},
	{2, FUN2},
	{0, NULL}, /*此行末尾可以加逗号，但不建议*/
	};

STR TBL2[] =  
	{1, FUN3},
	{2, FUN1},
	{0, NULL}, 
	};
	
STR* TBL_p[] = {TBL1,TBL2,NULL}; /*结构体数组名（指针）作为成员的一维指针数组*/

RunTbl_p = TBL_p[0];

ret = RunCtrl(RunTbl_p); /*此函数逻辑上对TBL1上的函数依次执行，也可根据执行情况，跳着执行*/

```

（2020.5.21）

## 4 字符char

### 4.1 “字符型数据类型”和“字符”

注意“字符型数据类型”和“字符”的区别，char 是可以存储数字的; 

字符型char是整数类型，只是为了方便处理字符，通过ASCII码用特定整数表示特定字符。

例如

```
char a = 48;
```

对于内存而言是相同的，输出使编译器会选择相应形式。

| 输出形式 | 值   |
| -------- | ---- |
| %d       | 48   |
| %c       | '0'  |

(2019.3)

### 4.2 常用字符ASCII码

| 字符        | ASCII |
| ----------- | ----- |
| 空字符 '\0' | 0     |
| 空格字符    | 32    |
| ‘0’         | 48    |

### 4.3 字符串

c语言中把字符串当作数组来处理的，比如char *a="hello";a[1]="e"; 

换句话说，字符串属于char类型的数组。并且，一定要‘\0’结束，即使空字符串也是。

字符串赋值与比较要用到库函数。（初始化除外）

(2019.4.15)

### 4.4 NULL

NULL (void *0)值为0，其实是0地址，C语言中不允许被访问。

C程序中 NULL = ‘\0’ 为真，只是两者数值正好相同，但两者本质不同。

(2019.7.5)

## 5 类型长度

### 5.1 sizeof

操作符sizeof(int) 和 sizeof( i )均合法。

### 5.2 64位macine

在64位机器中各类型的byte长度如下：

| 类型       | 字节长度 |
| ---------- | -------- |
| short      | 2        |
| int / long | 4        |
| float      | 4        |
| double     | 8        |
| void *     | 8        |

(2020.10)

### 5.3 float

注意计算机单精度浮点数float在内存中以科学计数法的形式储存，与int，char本质上不同。

## 6 C语言内存模型

| high address |            |                                  |
| ------------ | ---------- | -------------------------------- |
|              | stack      | 局部变量，函数参数               |
|              |            |                                  |
|              | heap       | 动态内存分配（malloc，free）     |
|              | BSS        | 存放未初始化的全局变量与静态变量 |
|              | Data       | 存放初始化后的全局变量和静态变量 |
|              | 文字常量区 | 常量字符串                       |
|              | Text       | 代码                             |
| **low**      |            |                                  |

注意点1：stack和heap相向延申；

注意点2：常量字符串存放与文字常量区，程序结束时系统释放，比如

```
strcpy(p1,"123456");
```

"123456"放在常量区，所有”123456“都会被编译器优化成一个地方。